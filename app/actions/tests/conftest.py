import json
from datetime import datetime

import pytest
from gundi_core.schemas import IntegrationInformation
from gundi_core.schemas.v2 import Connection, ConnectionIntegration
from pydantic import SecretStr

from app.actions.configurations import EdgeTechAuthConfiguration, EdgeTechConfiguration
from app.actions.edgetech.types import Buoy
from ropeless_utils import State


@pytest.fixture
def a_good_state():
    return State(
        er_token="super_secret_token",
        er_site="fishing.pamdas.org",
        event_source="fancy_buoy_company",
        er_event_type="gear_position",
        er_buoy_config=State(
            er_token="an_er_buoy_site_token",
            er_site="https://somewhere.buoyranger.org",
            event_source="some_other_buoy_company",
            er_event_type="gear_position",
        ),
    )


@pytest.fixture
def a_good_integration(a_good_state):
    return IntegrationInformation(
        id="00000000-0000-0000-0000-000000000000",
        state=a_good_state.dict(),
        enabled=True,
        name="Test Integration",
        endpoint="https://someplace.pamdas.orfg/api/v1.0",
        login="test_login",
        password="test_password",
        token="test_token",
    )


@pytest.fixture
def a_good_auth_configuration():
    token_data = {
        "access_token": "dummy_token",
        "refresh_token": "dummy_refresh",
        "expires_in": 86400,
        "expires_at": 1739552948.0993779,
    }
    return EdgeTechAuthConfiguration(
        token_json=SecretStr(json.dumps(token_data)),
        api_base_url="https://edgetech.api/",
        client_id="client123",
        redirect_uri="https://redirect.uri/",
        token_url="https://edgetech.api/token",
    )


@pytest.fixture
def a_good_pull_configuration():
    return EdgeTechConfiguration(
        api_base_url="https://edgetech.api/",
    )


@pytest.fixture
def a_good_connection():
    connection = Connection(
        provider=ConnectionIntegration(
            id="00000000-0000-0000-0000-000000000000",
        ),
        destinations=[
            ConnectionIntegration(
                id="00000000-0000-0000-0000-000000000001",
                name="Buoy Dev",
            ),
            ConnectionIntegration(
                id="00000000-0000-0000-0000-000000000002",
                name="Buoy Staging",
            ),
        ],
    )
    return connection


@pytest.fixture
def get_mock_edgetech_data():
    return [
        {
            "serialNumber": "88CE9978AE",
            "currentState": {
                "etag": '"1733842319546"',
                "isDeleted": False,
                "positionSetByCapri": False,
                "serialNumber": "88CE9978AE",
                "releaseCommand": "C8AB8C73AE",
                "statusCommand": "88CE9978AE",
                "idCommand": "CCCCCCCCCC",
                "isNfcTag": False,
                "modelNumber": "5112",
                "dateStatus": "2024-10-07T19:31:24.469Z",
                "statusRangeM": 0,
                "statusIsTilted": False,
                "statusBatterySoC": 86,
                "lastUpdated": "2024-12-10T14:51:59.546Z",
            },
            "changeRecords": [],
        },
        {
            "serialNumber": "88CE999763",
            "currentState": {
                "etag": '"1733842320416"',
                "isDeleted": False,
                "positionSetByCapri": False,
                "serialNumber": "88CE999763",
                "releaseCommand": "C8AB8CCAE3",
                "statusCommand": "88CE999763",
                "idCommand": "CCCCCCCCCC",
                "isNfcTag": False,
                "modelNumber": "5112",
                "dateOfManufacture": "2021-12-07T05:00:00.000Z",
                "dateOfBatteryCharge": "2023-03-28T04:00:00.000Z",
                "isDeployed": False,
                "dateRecovered": "2024-05-28T14:22:54.151Z",
                "dateStatus": "2023-09-23T20:07:48.458Z",
                "statusRangeM": 257.656,
                "statusIsTilted": False,
                "statusBatterySoC": 82,
                "lastUpdated": "2024-12-10T14:52:00.416Z",
            },
            "changeRecords": [],
        },
        {
            "serialNumber": "88CE99C99A",
            "currentState": {
                "etag": '"1733842326885"',
                "isDeleted": False,
                "positionSetByCapri": False,
                "serialNumber": "88CE99C99A",
                "releaseCommand": "C8AB8CCC9A",
                "statusCommand": "88CE99C99A",
                "idCommand": "CCCCCCCCCC",
                "isNfcTag": False,
                "modelNumber": "5112",
                "dateStatus": "2023-08-01T18:15:44.563Z",
                "statusRangeM": 0,
                "statusIsTilted": False,
                "statusBatterySoC": 62,
                "lastUpdated": "2024-12-10T14:52:06.885Z",
            },
            "changeRecords": [],
        },
        {
            "serialNumber": "88CE9978AE",
            "currentState": {
                "etag": '"1729614890401"',
                "isDeleted": False,
                "positionSetByCapri": False,
                "serialNumber": "88CE9978AE",
                "releaseCommand": "C8AB8C73AE",
                "statusCommand": "88CE9978AE",
                "idCommand": "CCCCCCCCCC",
                "isNfcTag": False,
                "latDeg": 41.82907459248435,
                "lonDeg": -71.41540430869928,
                "modelNumber": "5112",
                "dateOfManufacture": "2024-10-07T15:26:33.362Z",
                "dateOfBatteryCharge": "2024-10-07T15:26:34.034Z",
                "isDeployed": True,
                "dateDeployed": "2024-10-22T16:34:46.981Z",
                "lastUpdated": "2024-10-22T16:34:50.401Z",
            },
            "changeRecords": [],
        },
        {
            "serialNumber": "88CE99C99A",
            "currentState": {
                "etag": '"1741954819256"',
                "isDeleted": False,
                "positionSetByCapri": False,
                "serialNumber": "88CE99C99A",
                "releaseCommand": "C8AB8CCC9A",
                "statusCommand": "88CE99C99A",
                "idCommand": "CCCCCCCCCC",
                "isNfcTag": True,
                "modelNumber": "5112",
                "dateOfManufacture": "2022-12-21T05:00:00.000Z",
                "isDeployed": False,
                "dateRecovered": "2025-03-14T12:07:27.199Z",
                "recoveredLatDeg": 41.7832483,
                "recoveredLonDeg": -70.7527803,
                "recoveredRangeM": 0,
                "recoveredTemperatureC": 24,
                "dateStatus": "2025-03-14T12:20:13.201Z",
                "statusRangeM": 0,
                "statusIsTilted": True,
                "statusBatterySoC": 3,
                "lastUpdated": "2025-03-14T12:20:19.256Z",
            },
            "changeRecords": [],
        },
        {
            "serialNumber": "88CE9978AE",
            "currentState": {
                "etag": '"1739896745003"',
                "isDeleted": True,
                "positionSetByCapri": False,
                "serialNumber": "88CE9978AE",
                "releaseCommand": "C8AB8C73AE",
                "statusCommand": "88CE9978AE",
                "idCommand": "CCCCCCCCCC",
                "isNfcTag": False,
                "modelNumber": "5112",
                "isDeployed": False,
                "dateRecovered": "2025-02-13T15:30:42.492Z",
                "recoveredRangeM": 0,
                "recoveredTemperatureC": 7,
                "dateStatus": "2025-02-11T17:14:15.690Z",
                "statusRangeM": 0,
                "statusIsTilted": False,
                "statusBatterySoC": 0,
                "lastUpdated": "2025-02-18T16:39:05.003Z",
            },
            "changeRecords": [],
        },
        {
            "serialNumber": "88CE9978AE",
            "currentState": {
                "etag": '"1717697928807"',
                "isDeleted": False,
                "positionSetByCapri": False,
                "serialNumber": "88CE9978AE",
                "releaseCommand": "C8AB8C73AE",
                "statusCommand": "88CE9978AE",
                "idCommand": "CCCCCCCCCC",
                "isNfcTag": False,
                "modelNumber": "5112",
                "dateStatus": "2024-06-06T18:16:22.470Z",
                "statusRangeM": 1.498,
                "statusIsTilted": True,
                "statusBatterySoC": 94,
                "lastUpdated": "2024-06-06T18:18:48.807Z",
            },
            "changeRecords": [],
        },
        {
            "serialNumber": "88CE99C99A",
            "currentState": {
                "etag": '"1682088076708"',
                "isDeleted": False,
                "positionSetByCapri": False,
                "serialNumber": "88CE99C99A",
                "releaseCommand": "C8AB8CCC9A",
                "statusCommand": "88CE99C99A",
                "idCommand": "CCCCCCCCCC",
                "isNfcTag": True,
                "modelNumber": "5112",
                "dateOfManufacture": "2022-12-21T05:00:00.000Z",
                "dateStatus": "2023-04-21T14:41:08.627Z",
                "statusRangeM": 1575.89599609375,
                "lastUpdated": "2023-04-21T14:41:16.708Z",
            },
            "changeRecords": [],
        },
        {
            "serialNumber": "88CE99C99A",
            "currentState": {
                "etag": '"1733241895379"',
                "isDeleted": False,
                "positionSetByCapri": False,
                "serialNumber": "88CE99C99A",
                "releaseCommand": "C8AB8CCC9A",
                "statusCommand": "88CE99C99A",
                "idCommand": "CCCCCCCCCC",
                "isNfcTag": False,
                "modelNumber": "5112",
                "dateOfManufacture": "2022-12-21T05:00:00.000Z",
                "isDeployed": False,
                "dateRecovered": "2024-12-03T16:04:55.230Z",
                "recoveredLatDeg": 41.5740898,
                "recoveredLonDeg": -70.8831463,
                "dateStatus": "2024-12-03T15:23:51.886Z",
                "statusRangeM": 58.422,
                "statusIsTilted": False,
                "statusBatterySoC": 104,
                "lastUpdated": "2024-12-03T16:04:55.379Z",
            },
            "changeRecords": [],
        },
        {
            "serialNumber": "88CE999763",
            "currentState": {
                "etag": '"1726594987576"',
                "isDeleted": False,
                "positionSetByCapri": False,
                "serialNumber": "88CE999763",
                "releaseCommand": "C8AB8CCAE3",
                "statusCommand": "88CE999763",
                "idCommand": "CCCCCCCCCC",
                "isNfcTag": False,
                "lastUpdated": "2024-09-17T17:43:07.576Z",
            },
            "changeRecords": [],
        },
        {
            "serialNumber": "88CE99C99A",
            "currentState": {
                "etag": '"1726083572993"',
                "isDeleted": False,
                "positionSetByCapri": False,
                "serialNumber": "88CE99C99A",
                "releaseCommand": "C8AB8CCC9A",
                "statusCommand": "88CE99C99A",
                "idCommand": "CCCCCCCCCC",
                "isNfcTag": False,
                "dateStatus": "2024-09-11T19:34:41.744Z",
                "statusRangeM": 0,
                "statusIsTilted": True,
                "statusBatterySoC": 69,
                "lastUpdated": "2024-09-11T19:39:32.993Z",
            },
            "changeRecords": [],
        },
        {
            "serialNumber": "88CE9978AE",
            "currentState": {
                "etag": '"1728330307444"',
                "isDeleted": False,
                "positionSetByCapri": False,
                "serialNumber": "88CE9978AE",
                "releaseCommand": "C8AB8C73AE",
                "statusCommand": "88CE9978AE",
                "idCommand": "CCCCCCCCCC",
                "isNfcTag": False,
                "modelNumber": "5112",
                "dateStatus": "2024-10-07T19:31:24.469Z",
                "statusRangeM": 0,
                "statusIsTilted": False,
                "statusBatterySoC": 86,
                "lastUpdated": "2024-10-07T19:45:07.444Z",
            },
            "changeRecords": [],
        },
        {
            "serialNumber": "88CE999763",
            "currentState": {
                "etag": '"1742232994823"',
                "isDeleted": False,
                "positionSetByCapri": False,
                "serialNumber": "88CE999763",
                "releaseCommand": "C8AB8CCAE3",
                "statusCommand": "88CE999763",
                "idCommand": "CCCCCCCCCC",
                "isNfcTag": False,
                "modelNumber": "5112",
                "dateOfManufacture": "2021-12-07T05:00:00.000Z",
                "dateOfBatteryCharge": "2023-03-28T04:00:00.000Z",
                "isDeployed": False,
                "dateRecovered": "2025-03-17T17:36:32.643Z",
                "dateStatus": "2023-09-23T20:07:48.458Z",
                "statusRangeM": 257.656,
                "statusIsTilted": False,
                "statusBatterySoC": 82,
                "lastUpdated": "2025-03-17T17:36:34.823Z",
            },
            "changeRecords": [
                {
                    "type": "MODIFY",
                    "timestamp": "2025-03-17T17:36:34.000Z",
                    "changes": [
                        {
                            "key": "dateDeployed",
                            "oldValue": "2025-03-17T16:43:40.228Z",
                            "newValue": None,
                        },
                        {
                            "key": "dateRecovered",
                            "oldValue": None,
                            "newValue": "2025-03-17T17:36:32.643Z",
                        },
                        {
                            "key": "endLatDeg",
                            "oldValue": 41.52537796592242,
                            "newValue": None,
                        },
                        {
                            "key": "endLonDeg",
                            "oldValue": -70.6738777899687,
                            "newValue": None,
                        },
                        {"key": "geoHash", "oldValue": "89e4d", "newValue": "X"},
                        {"key": "isDeployed", "oldValue": True, "newValue": False},
                        {
                            "key": "lastUpdated",
                            "oldValue": "2025-03-17T16:43:40.831Z",
                            "newValue": "2025-03-17T17:36:34.823Z",
                        },
                        {
                            "key": "latDeg",
                            "oldValue": 41.52546746182916,
                            "newValue": None,
                        },
                        {
                            "key": "lonDeg",
                            "oldValue": -70.67401171221228,
                            "newValue": None,
                        },
                    ],
                },
                {
                    "type": "MODIFY",
                    "timestamp": "2025-03-17T16:43:40.000Z",
                    "changes": [
                        {
                            "key": "dateDeployed",
                            "oldValue": None,
                            "newValue": "2025-03-17T16:43:40.228Z",
                        },
                        {
                            "key": "dateRecovered",
                            "oldValue": "2025-03-17T16:41:22.508Z",
                            "newValue": None,
                        },
                        {
                            "key": "endLatDeg",
                            "oldValue": None,
                            "newValue": 41.52537796592242,
                        },
                        {
                            "key": "endLonDeg",
                            "oldValue": None,
                            "newValue": -70.6738777899687,
                        },
                        {"key": "geoHash", "oldValue": "X", "newValue": "89e4d"},
                        {"key": "isDeployed", "oldValue": False, "newValue": True},
                        {
                            "key": "lastUpdated",
                            "oldValue": "2025-03-17T16:43:14.071Z",
                            "newValue": "2025-03-17T16:43:40.831Z",
                        },
                        {
                            "key": "latDeg",
                            "oldValue": None,
                            "newValue": 41.52546746182916,
                        },
                        {
                            "key": "lonDeg",
                            "oldValue": None,
                            "newValue": -70.67401171221228,
                        },
                    ],
                },
                {
                    "type": "MODIFY",
                    "timestamp": "2025-03-17T16:43:14.000Z",
                    "changes": [
                        {
                            "key": "dateDeployed",
                            "oldValue": "2025-03-17T16:26:12.059Z",
                            "newValue": None,
                        },
                        {
                            "key": "dateRecovered",
                            "oldValue": None,
                            "newValue": "2025-03-17T16:41:22.508Z",
                        },
                        {"key": "geoHash", "oldValue": "89e4d", "newValue": "X"},
                        {"key": "isDeployed", "oldValue": True, "newValue": False},
                        {
                            "key": "lastUpdated",
                            "oldValue": "2025-03-17T16:26:12.457Z",
                            "newValue": "2025-03-17T16:43:14.071Z",
                        },
                        {
                            "key": "latDeg",
                            "oldValue": 41.52546746182916,
                            "newValue": None,
                        },
                        {
                            "key": "lonDeg",
                            "oldValue": -70.67401171221228,
                            "newValue": None,
                        },
                    ],
                },
                {
                    "type": "MODIFY",
                    "timestamp": "2025-03-17T16:26:12.000Z",
                    "changes": [
                        {
                            "key": "dateDeployed",
                            "oldValue": None,
                            "newValue": "2025-03-17T16:26:12.059Z",
                        },
                        {
                            "key": "dateRecovered",
                            "oldValue": "2024-05-28T14:22:54.151Z",
                            "newValue": None,
                        },
                        {"key": "geoHash", "oldValue": "X", "newValue": "89e4d"},
                        {"key": "isDeployed", "oldValue": False, "newValue": True},
                        {
                            "key": "lastUpdated",
                            "oldValue": "2024-05-28T14:22:55.449Z",
                            "newValue": "2025-03-17T16:26:12.457Z",
                        },
                        {
                            "key": "latDeg",
                            "oldValue": None,
                            "newValue": 41.52546746182916,
                        },
                        {
                            "key": "lonDeg",
                            "oldValue": None,
                            "newValue": -70.67401171221228,
                        },
                    ],
                },
            ],
        },
        {
            "serialNumber": "88CE99C99A",
            "currentState": {
                "etag": '"1691005965618"',
                "isDeleted": False,
                "positionSetByCapri": False,
                "serialNumber": "88CE99C99A",
                "releaseCommand": "C8AB8CCC9A",
                "statusCommand": "88CE99C99A",
                "idCommand": "CCCCCCCCCC",
                "isNfcTag": False,
                "modelNumber": "5112",
                "dateStatus": "2023-08-01T18:15:44.563Z",
                "statusRangeM": 0,
                "statusIsTilted": False,
                "statusBatterySoC": 62,
                "lastUpdated": "2023-08-02T19:52:45.618Z",
            },
            "changeRecords": [],
        },
        {
            "serialNumber": "88CE99C99A",
            "currentState": {
                "etag": '"1692717424234"',
                "isDeleted": False,
                "positionSetByCapri": False,
                "serialNumber": "88CE99C99A",
                "releaseCommand": "C8AB8CCC9A",
                "statusCommand": "88CE99C99A",
                "idCommand": "CCCCCCCCCC",
                "isNfcTag": True,
                "modelNumber": "5112",
                "dateOfManufacture": "2022-12-21T05:00:00.000Z",
                "dateStatus": "2023-08-22T15:17:01.599Z",
                "statusRangeM": 7.489999771118164,
                "statusIsTilted": False,
                "statusBatterySoC": 71,
                "lastUpdated": "2023-08-22T15:17:04.234Z",
            },
            "changeRecords": [],
        },
        {
            "serialNumber": "88CE99D9CB",
            "currentState": {
                "etag": "1728400591740",
                "isDeleted": False,
                "positionSetByCapri": False,
                "serialNumber": "88CE99D9CB",
                "releaseCommand": "C8AB8C74CB",
                "statusCommand": "88CE99D9CB",
                "idCommand": "CCCCCCCCCC",
                "isNfcTag": False,
                "modelNumber": "5112",
                "dateStatus": "2024-10-08T15:15:48.967Z",
                "statusRangeM": 0,
                "statusIsTilted": False,
                "statusBatterySoC": 88,
                "lastUpdated": "2024-10-08T15:16:31.740Z",
            },
            "changeRecords": [],
        },
        {
            "serialNumber": "88CE99D9CB",
            "currentState": {
                "etag": "1733842329272",
                "isDeleted": False,
                "positionSetByCapri": False,
                "serialNumber": "88CE99D9CB",
                "releaseCommand": "C8AB8C74CB",
                "statusCommand": "88CE99D9CB",
                "idCommand": "CCCCCCCCCC",
                "isNfcTag": False,
                "modelNumber": "5112",
                "dateStatus": "2024-10-08T15:15:48.967Z",
                "statusRangeM": 0,
                "statusIsTilted": False,
                "statusBatterySoC": 88,
                "lastUpdated": "2024-12-10T14:52:09.272Z",
            },
            "changeRecords": [],
        },
        {
            "serialNumber": "88CE99D9CB",
            "currentState": {
                "etag": "1743692136313",
                "isDeleted": True,
                "positionSetByCapri": False,
                "serialNumber": "88CE99D9CB",
                "releaseCommand": "C8AB8C74CB",
                "statusCommand": "88CE99D9CB",
                "idCommand": "CCCCCCCCCC",
                "isNfcTag": False,
                "modelNumber": "",
                "dateStatus": "2024-07-24T13:10:08.580Z",
                "statusRangeM": 0,
                "statusIsTilted": False,
                "statusBatterySoC": 68,
                "lastUpdated": "2025-04-03T14:55:36.313Z",
            },
            "changeRecords": [],
        },
        {
            "serialNumber": "88CE99D9CB",
            "currentState": {
                "etag": "1744302272094",
                "isDeleted": False,
                "positionSetByCapri": False,
                "serialNumber": "88CE99D9CB",
                "releaseCommand": "C8AB8C74CB",
                "statusCommand": "88CE99D9CB",
                "idCommand": "CCCCCCCCCC",
                "isNfcTag": False,
                "modelNumber": "",
                "isDeployed": False,
                "dateRecovered": "2025-04-10T16:24:20.800Z",
                "recoveredLatDeg": 42.2290093,
                "recoveredLonDeg": -70.6304546,
                "recoveredRangeM": 95.872,
                "recoveredTemperatureC": 4,
                "lastUpdated": "2025-04-10T16:24:32.094Z",
            },
            "changeRecords": [],
        },
        {
            "serialNumber": "88CE99D9CB",
            "currentState": {
                "etag": "1745530829705",
                "isDeleted": False,
                "positionSetByCapri": False,
                "serialNumber": "88CE99D9CB",
                "releaseCommand": "C8AB8C74CB",
                "statusCommand": "88CE99D9CB",
                "idCommand": "CCCCCCCCCC",
                "isNfcTag": False,
                "modelNumber": "5112",
                "dateStatus": "2024-10-08T15:15:48.967Z",
                "statusRangeM": 0,
                "statusIsTilted": False,
                "statusBatterySoC": 88,
                "lastUpdated": "2025-04-24T21:40:29.705Z",
            },
            "changeRecords": [
                {
                    "type": "INSERT",
                    "timestamp": "2025-04-24T21:40:29.000Z",
                    "changes": [],
                }
            ],
        },
        {
            "serialNumber": "88CE99DA78",
            "currentState": {
                "etag": "1742573159395",
                "isDeleted": False,
                "positionSetByCapri": False,
                "serialNumber": "88CE99DA78",
                "releaseCommand": "C8AB8C7578",
                "statusCommand": "88CE99DA78",
                "idCommand": "CCCCCCCCCC",
                "isNfcTag": True,
                "latDeg": 49.30788893117735,
                "lonDeg": -123.23345710912099,
                "modelNumber": "5112",
                "dateOfManufacture": "2024-03-23T07:00:00.000Z",
                "isDeployed": True,
                "dateDeployed": "2025-03-21T16:05:59.063Z",
                "dateStatus": "2025-03-17T17:16:47.958Z",
                "statusRangeM": 91.378,
                "statusIsTilted": False,
                "statusBatterySoC": 68,
                "lastUpdated": "2025-03-21T16:05:59.395Z",
            },
            "changeRecords": [],
        },
    ]


@pytest.fixture
def get_er_subjects_updated_data():
    return [
        {
            "content_type": "observations.subject",
            "id": "015afed5-bc84-4872-b9fa-0e6b2f67b72c",
            "name": "edgetech_88CE999763_A",
            "subject_type": "ropeless_buoy",
            "subject_subtype": "ropeless_buoy_device",
            "common_name": None,
            "additional": {
                "devices": [
                    {
                        "label": "a",
                        "location": {
                            "latitude": 41.52546746182916,
                            "longitude": -70.67401171221228,
                        },
                        "device_id": "edgetech_88CE999763_A",
                        "last_updated": "2025-03-17T16:26:12+00:00",
                    }
                ],
                "display_id": "88CE999763",
                "event_type": "gear_deployed",
                "subject_name": "edgetech_88CE999763_A",
                "edgetech_serial_number": "88CE999763",
            },
            "created_at": "2025-03-21T13:33:10.537494-07:00",
            "updated_at": "2025-03-21T13:33:10.537528-07:00",
            "is_active": False,
            "user": None,
            "tracks_available": True,
            "image_url": "/static/pin-black.svg",
            "last_position_status": {
                "last_voice_call_start_at": None,
                "radio_state_at": None,
                "radio_state": "na",
            },
            "last_position_date": "2025-03-17T17:36:32+00:00",
            "last_position": {
                "type": "Feature",
                "geometry": {
                    "type": "Point",
                    "coordinates": [-70.67401171221228, 41.52546746182916],
                },
                "properties": {
                    "title": "edgetech_88CE999763_A",
                    "subject_type": "ropeless_buoy",
                    "subject_subtype": "ropeless_buoy_device",
                    "id": "015afed5-bc84-4872-b9fa-0e6b2f67b72c",
                    "stroke": "#FFFF00",
                    "stroke-opacity": 1.0,
                    "stroke-width": 2,
                    "image": "https://buoy.dev.pamdas.org/static/pin-black.svg",
                    "last_voice_call_start_at": None,
                    "location_requested_at": None,
                    "radio_state_at": "1970-01-01T00:00:00+00:00",
                    "radio_state": "na",
                    "coordinateProperties": {"time": "2025-03-17T17:36:32+00:00"},
                    "DateTime": "2025-03-17T17:36:32+00:00",
                },
            },
            "device_status_properties": None,
            "url": "https://buoy.dev.pamdas.org/api/v1.0/subject/015afed5-bc84-4872-b9fa-0e6b2f67b72c",
        },
        {
            "content_type": "observations.subject",
            "id": "48626952-ff1a-40fe-8d4d-1427084bec24",
            "name": "edgetech_88CE999763_B",
            "subject_type": "ropeless_buoy",
            "subject_subtype": "ropeless_buoy_device",
            "common_name": None,
            "additional": {
                "devices": [
                    {
                        "label": "a",
                        "location": {
                            "latitude": 41.52546746182916,
                            "longitude": -70.67401171221228,
                        },
                        "device_id": "edgetech_88CE999763_A",
                        "last_updated": "2025-03-17T17:36:32+00:00",
                    },
                    {
                        "label": "b",
                        "location": {
                            "latitude": 41.52537796592242,
                            "longitude": -70.6738777899687,
                        },
                        "device_id": "edgetech_88CE999763_B",
                        "last_updated": "2025-03-17T17:36:32+00:00",
                    },
                ],
                "display_id": "88CE999763",
                "event_type": "gear_retrieved",
                "subject_name": "edgetech_88CE999763_B",
                "edgetech_serial_number": "88CE999763",
            },
            "created_at": "2025-03-21T13:33:12.033995-07:00",
            "updated_at": "2025-03-21T13:33:12.034028-07:00",
            "is_active": False,
            "user": None,
            "tracks_available": True,
            "image_url": "/static/pin-black.svg",
            "last_position_status": {
                "last_voice_call_start_at": None,
                "radio_state_at": None,
                "radio_state": "na",
            },
            "last_position_date": "2025-03-17T17:36:32+00:00",
            "last_position": {
                "type": "Feature",
                "geometry": {
                    "type": "Point",
                    "coordinates": [-70.6738777899687, 41.52537796592242],
                },
                "properties": {
                    "title": "edgetech_88CE999763_B",
                    "subject_type": "ropeless_buoy",
                    "subject_subtype": "ropeless_buoy_device",
                    "id": "48626952-ff1a-40fe-8d4d-1427084bec24",
                    "stroke": "#FFFF00",
                    "stroke-opacity": 1.0,
                    "stroke-width": 2,
                    "image": "https://buoy.dev.pamdas.org/static/pin-black.svg",
                    "last_voice_call_start_at": None,
                    "location_requested_at": None,
                    "radio_state_at": "1970-01-01T00:00:00+00:00",
                    "radio_state": "na",
                    "coordinateProperties": {"time": "2025-03-17T17:36:32+00:00"},
                    "DateTime": "2025-03-17T17:36:32+00:00",
                },
            },
            "device_status_properties": None,
            "url": "https://buoy.dev.pamdas.org/api/v1.0/subject/48626952-ff1a-40fe-8d4d-1427084bec24",
        },
        {
            "content_type": "observations.subject",
            "id": "8f8dcf49-0b73-4a29-81ce-d3bb0f293f98",
            "name": "edgetech_88CE9978AE_A",
            "subject_type": "ropeless_buoy",
            "subject_subtype": "ropeless_buoy_device",
            "common_name": None,
            "additional": {
                "devices": [
                    {
                        "label": "a",
                        "location": {
                            "latitude": 41.82907459248435,
                            "longitude": -71.41540430869928,
                        },
                        "device_id": "edgetech_88CE9978AE_A",
                        "last_updated": "2024-12-10T14:51:59+00:00",
                    }
                ],
                "display_id": "88CE9978AE",
                "event_type": "gear_retrieved",
                "subject_name": "edgetech_88CE9978AE_A",
                "edgetech_serial_number": "88CE9978AE",
            },
            "created_at": "2025-03-21T13:33:24.351567-07:00",
            "updated_at": "2025-03-21T13:33:24.351595-07:00",
            "is_active": False,
            "user": None,
            "tracks_available": True,
            "image_url": "/static/pin-black.svg",
            "last_position_status": {
                "last_voice_call_start_at": None,
                "radio_state_at": None,
                "radio_state": "na",
            },
            "last_position_date": "2025-02-13T15:30:42+00:00",
            "last_position": {
                "type": "Feature",
                "geometry": {
                    "type": "Point",
                    "coordinates": [-71.41540430869928, 41.82907459248435],
                },
                "properties": {
                    "title": "edgetech_88CE9978AE_A",
                    "subject_type": "ropeless_buoy",
                    "subject_subtype": "ropeless_buoy_device",
                    "id": "8f8dcf49-0b73-4a29-81ce-d3bb0f293f98",
                    "stroke": "#FFFF00",
                    "stroke-opacity": 1.0,
                    "stroke-width": 2,
                    "image": "https://buoy.dev.pamdas.org/static/pin-black.svg",
                    "last_voice_call_start_at": None,
                    "location_requested_at": None,
                    "radio_state_at": "1970-01-01T00:00:00+00:00",
                    "radio_state": "na",
                    "coordinateProperties": {"time": "2025-02-13T15:30:42+00:00"},
                    "DateTime": "2025-02-13T15:30:42+00:00",
                },
            },
            "device_status_properties": None,
            "url": "https://buoy.dev.pamdas.org/api/v1.0/subject/8f8dcf49-0b73-4a29-81ce-d3bb0f293f98",
        },
        {
            "content_type": "observations.subject",
            "id": "a90fba94-0868-4af7-a6ac-8e61df94976c",
            "name": "edgetech_88CE99C99A_A",
            "subject_type": "ropeless_buoy",
            "subject_subtype": "ropeless_buoy_device",
            "common_name": None,
            "additional": {
                "devices": [
                    {
                        "label": "a",
                        "location": {
                            "latitude": 41.5740898,
                            "longitude": -70.8831463,
                        },
                        "device_id": "edgetech_88CE99C99A_A",
                        "last_updated": "2024-12-10T14:52:06+00:00",
                    }
                ],
                "display_id": "88CE99C99A",
                "event_type": "gear_retrieved",
                "subject_name": "edgetech_88CE99C99A_A",
                "edgetech_serial_number": "88CE99C99A",
            },
            "created_at": "2025-03-21T13:33:17.862024-07:00",
            "updated_at": "2025-03-21T13:33:17.862049-07:00",
            "is_active": False,
            "user": None,
            "tracks_available": True,
            "image_url": "/static/pin-black.svg",
            "last_position_status": {
                "last_voice_call_start_at": None,
                "radio_state_at": None,
                "radio_state": "na",
            },
            "last_position_date": "2025-03-14T12:07:27+00:00",
            "last_position": {
                "type": "Feature",
                "geometry": {
                    "type": "Point",
                    "coordinates": [-70.7527803, 41.7832483],
                },
                "properties": {
                    "title": "edgetech_88CE99C99A_A",
                    "subject_type": "ropeless_buoy",
                    "subject_subtype": "ropeless_buoy_device",
                    "id": "a90fba94-0868-4af7-a6ac-8e61df94976c",
                    "stroke": "#FFFF00",
                    "stroke-opacity": 1.0,
                    "stroke-width": 2,
                    "image": "https://buoy.dev.pamdas.org/static/pin-black.svg",
                    "last_voice_call_start_at": None,
                    "location_requested_at": None,
                    "radio_state_at": "1970-01-01T00:00:00+00:00",
                    "radio_state": "na",
                    "coordinateProperties": {"time": "2025-03-14T12:07:27+00:00"},
                    "DateTime": "2025-03-14T12:07:27+00:00",
                },
            },
            "device_status_properties": None,
            "url": "https://buoy.dev.pamdas.org/api/v1.0/subject/a90fba94-0868-4af7-a6ac-8e61df94976c",
        },
        {
            "content_type": "observations.subject",
            "id": "bd29dbde-7138-48bf-b612-ae236506cefe",
            "name": "edgetech_88CE999763_A",
            "subject_type": "ropeless_buoy",
            "subject_subtype": "ropeless_buoy_device",
            "common_name": None,
            "additional": {
                "devices": [
                    {
                        "label": "a",
                        "location": {
                            "latitude": 41.52546746182916,
                            "longitude": -70.67401171221228,
                        },
                        "device_id": "edgetech_88CE999763_A",
                        "last_updated": "2025-03-17T17:36:32+00:00",
                    },
                    {
                        "label": "b",
                        "location": {
                            "latitude": 41.52537796592242,
                            "longitude": -70.6738777899687,
                        },
                        "device_id": "edgetech_88CE999763_B",
                        "last_updated": "2025-03-17T17:36:32+00:00",
                    },
                ],
                "display_id": "a30695bbab45",
                "event_type": "gear_retrieved",
                "subject_name": "edgetech_88CE999763_A",
                "rmwhub_set_id": "e_333e6ad9-88a2-4c68-a631-af5c70e4b727",
            },
            "created_at": "2025-03-21T15:21:41.890043-07:00",
            "updated_at": "2025-03-21T15:21:41.890067-07:00",
            "is_active": False,
            "user": None,
            "tracks_available": True,
            "image_url": "/static/pin-black.svg",
            "last_position_status": {
                "last_voice_call_start_at": None,
                "radio_state_at": None,
                "radio_state": "na",
            },
            "last_position_date": "2025-03-21T20:33:12+00:00",
            "last_position": {
                "type": "Feature",
                "geometry": {
                    "type": "Point",
                    "coordinates": [-70.67401171221228, 41.52546746182916],
                },
                "properties": {
                    "title": "edgetech_88CE999763_A",
                    "subject_type": "ropeless_buoy",
                    "subject_subtype": "ropeless_buoy_device",
                    "id": "bd29dbde-7138-48bf-b612-ae236506cefe",
                    "stroke": "#FFFF00",
                    "stroke-opacity": 1.0,
                    "stroke-width": 2,
                    "image": "https://buoy.dev.pamdas.org/static/pin-black.svg",
                    "last_voice_call_start_at": None,
                    "location_requested_at": None,
                    "radio_state_at": "1970-01-01T00:00:00+00:00",
                    "radio_state": "na",
                    "coordinateProperties": {"time": "2025-03-21T20:33:12+00:00"},
                    "DateTime": "2025-03-21T20:33:12+00:00",
                },
            },
            "device_status_properties": None,
            "url": "https://buoy.dev.pamdas.org/api/v1.0/subject/bd29dbde-7138-48bf-b612-ae236506cefe",
        },
        {
            "content_type": "observations.subject",
            "id": "c1c67282-0d58-4a6c-ba82-9593ee8f7056",
            "name": "edgetech_88CE9978AE_A",
            "subject_type": "ropeless_buoy",
            "subject_subtype": "ropeless_buoy_device",
            "common_name": None,
            "additional": {
                "devices": [
                    {
                        "label": "a",
                        "location": {
                            "latitude": 41.82907459248435,
                            "longitude": -71.41540430869928,
                        },
                        "device_id": "edgetech_88CE9978AE_A",
                        "last_updated": "2024-12-10T14:51:59+00:00",
                    }
                ],
                "display_id": "bd758697f348",
                "event_type": "gear_retrieved",
                "subject_name": "edgetech_88CE9978AE_A",
                "rmwhub_set_id": "e_402a17d1-dbe3-4ace-a861-dec1d7191f5e",
            },
            "created_at": "2025-03-21T15:21:42.190554-07:00",
            "updated_at": "2025-03-21T15:21:42.190591-07:00",
            "is_active": False,
            "user": None,
            "tracks_available": True,
            "image_url": "/static/pin-black.svg",
            "last_position_status": {
                "last_voice_call_start_at": None,
                "radio_state_at": None,
                "radio_state": "na",
            },
            "last_position_date": "2025-03-21T20:33:24+00:00",
            "last_position": {
                "type": "Feature",
                "geometry": {
                    "type": "Point",
                    "coordinates": [-71.41540430869928, 41.82907459248435],
                },
                "properties": {
                    "title": "edgetech_88CE9978AE_A",
                    "subject_type": "ropeless_buoy",
                    "subject_subtype": "ropeless_buoy_device",
                    "id": "c1c67282-0d58-4a6c-ba82-9593ee8f7056",
                    "stroke": "#FFFF00",
                    "stroke-opacity": 1.0,
                    "stroke-width": 2,
                    "image": "https://buoy.dev.pamdas.org/static/pin-black.svg",
                    "last_voice_call_start_at": None,
                    "location_requested_at": None,
                    "radio_state_at": "1970-01-01T00:00:00+00:00",
                    "radio_state": "na",
                    "coordinateProperties": {"time": "2025-03-21T20:33:24+00:00"},
                    "DateTime": "2025-03-21T20:33:24+00:00",
                },
            },
            "device_status_properties": None,
            "url": "https://buoy.dev.pamdas.org/api/v1.0/subject/c1c67282-0d58-4a6c-ba82-9593ee8f7056",
        },
        {
            "content_type": "observations.subject",
            "id": "cbd865ab-b0ed-4faf-9169-88fe097d0ece",
            "name": "edgetech_88CE999763_B",
            "subject_type": "ropeless_buoy",
            "subject_subtype": "ropeless_buoy_device",
            "common_name": None,
            "additional": {
                "devices": [
                    {
                        "label": "a",
                        "location": {
                            "latitude": 41.52546746182916,
                            "longitude": -70.67401171221228,
                        },
                        "device_id": "edgetech_88CE999763_A",
                        "last_updated": "2025-03-17T17:36:32+00:00",
                    },
                    {
                        "label": "b",
                        "location": {
                            "latitude": 41.52537796592242,
                            "longitude": -70.6738777899687,
                        },
                        "device_id": "edgetech_88CE999763_B",
                        "last_updated": "2025-03-17T17:36:32+00:00",
                    },
                ],
                "display_id": "a30695bbab45",
                "event_type": "gear_retrieved",
                "subject_name": "edgetech_88CE999763_B",
                "rmwhub_set_id": "e_333e6ad9-88a2-4c68-a631-af5c70e4b727",
            },
            "created_at": "2025-03-21T15:21:41.659776-07:00",
            "updated_at": "2025-03-21T15:21:41.659801-07:00",
            "is_active": False,
            "user": None,
            "tracks_available": True,
            "image_url": "/static/pin-black.svg",
            "last_position_status": {
                "last_voice_call_start_at": None,
                "radio_state_at": None,
                "radio_state": "na",
            },
            "last_position_date": "2025-03-21T20:33:12+00:00",
            "last_position": {
                "type": "Feature",
                "geometry": {
                    "type": "Point",
                    "coordinates": [-70.6738777899687, 41.52537796592242],
                },
                "properties": {
                    "title": "edgetech_88CE999763_B",
                    "subject_type": "ropeless_buoy",
                    "subject_subtype": "ropeless_buoy_device",
                    "id": "cbd865ab-b0ed-4faf-9169-88fe097d0ece",
                    "stroke": "#FFFF00",
                    "stroke-opacity": 1.0,
                    "stroke-width": 2,
                    "image": "https://buoy.dev.pamdas.org/static/pin-black.svg",
                    "last_voice_call_start_at": None,
                    "location_requested_at": None,
                    "radio_state_at": "1970-01-01T00:00:00+00:00",
                    "radio_state": "na",
                    "coordinateProperties": {"time": "2025-03-21T20:33:12+00:00"},
                    "DateTime": "2025-03-21T20:33:12+00:00",
                },
            },
            "device_status_properties": None,
            "url": "https://buoy.dev.pamdas.org/api/v1.0/subject/cbd865ab-b0ed-4faf-9169-88fe097d0ece",
        },
        {
            "content_type": "observations.subject",
            "id": "f78ffc4f-a91a-4057-b8ae-2e7a1657ac1f",
            "name": "edgetech_88CE99C99A_A",
            "subject_type": "ropeless_buoy",
            "subject_subtype": "ropeless_buoy_device",
            "common_name": None,
            "additional": {
                "devices": [
                    {
                        "label": "a",
                        "location": {
                            "latitude": 41.5740898,
                            "longitude": -70.8831463,
                        },
                        "device_id": "edgetech_88CE99C99A_A",
                        "last_updated": "2024-12-10T14:52:06+00:00",
                    }
                ],
                "display_id": "1573bba14133",
                "event_type": "gear_retrieved",
                "subject_name": "edgetech_88CE99C99A_A",
                "rmwhub_set_id": "e_fc439758-ee70-4514-847a-4eeee3456cf8",
            },
            "created_at": "2025-03-21T15:21:36.810455-07:00",
            "updated_at": "2025-03-21T15:21:36.810475-07:00",
            "is_active": False,
            "user": None,
            "tracks_available": True,
            "image_url": "/static/pin-black.svg",
            "last_position_status": {
                "last_voice_call_start_at": None,
                "radio_state_at": None,
                "radio_state": "na",
            },
            "last_position_date": "2025-03-21T20:33:17+00:00",
            "last_position": {
                "type": "Feature",
                "geometry": {
                    "type": "Point",
                    "coordinates": [-70.8831463, 41.5740898],
                },
                "properties": {
                    "title": "edgetech_88CE99C99A_A",
                    "subject_type": "ropeless_buoy",
                    "subject_subtype": "ropeless_buoy_device",
                    "id": "f78ffc4f-a91a-4057-b8ae-2e7a1657ac1f",
                    "stroke": "#FFFF00",
                    "stroke-opacity": 1.0,
                    "stroke-width": 2,
                    "image": "https://buoy.dev.pamdas.org/static/pin-black.svg",
                    "last_voice_call_start_at": None,
                    "location_requested_at": None,
                    "radio_state_at": "1970-01-01T00:00:00+00:00",
                    "radio_state": "na",
                    "coordinateProperties": {"time": "2025-03-21T20:33:17+00:00"},
                    "DateTime": "2025-03-21T20:33:17+00:00",
                },
            },
            "device_status_properties": None,
            "url": "https://buoy.dev.pamdas.org/api/v1.0/subject/f78ffc4f-a91a-4057-b8ae-2e7a1657ac1f",
        },
        {
            "content_type": "observations.subject",
            "id": "9cd78277-f638-4ce6-89f8-55125a1c6540",
            "name": "edgetech_88CE99D9CB_A",
            "subject_type": "ropeless_buoy",
            "subject_subtype": "ropeless_buoy_device",
            "common_name": None,
            "additional": {
                "devices": [
                    {
                        "label": "a",
                        "location": {"latitude": 42.2290093, "longitude": -70.6304546},
                        "device_id": "edgetech_88CE99D9CB_A",
                        "last_updated": "2025-04-24T21:40:29+00:00",
                    }
                ],
                "display_id": "2e1a1f4d63c5",
                "event_type": "gear_retrieved",
                "subject_name": "edgetech_88CE99D9CB_A",
                "subject_is_active": False,
                "edgetech_serial_number": "88CE99D9CB",
            },
            "created_at": "2025-03-28T14:13:43.181893-07:00",
            "updated_at": "2025-04-24T14:42:23.003928-07:00",
            "is_active": False,
            "user": None,
            "tracks_available": True,
            "image_url": "/static/pin-black.svg",
            "last_position_status": {
                "last_voice_call_start_at": None,
                "radio_state_at": None,
                "radio_state": "na",
            },
            "last_position_date": "2025-04-24T21:40:29+00:00",
            "last_position": {
                "type": "Feature",
                "geometry": {"type": "Point", "coordinates": [-70.6304546, 42.2290093]},
                "properties": {
                    "title": "edgetech_88CE99D9CB_A",
                    "subject_type": "ropeless_buoy",
                    "subject_subtype": "ropeless_buoy_device",
                    "id": "9cd78277-f638-4ce6-89f8-55125a1c6540",
                    "stroke": "#FFFF00",
                    "stroke-opacity": 1.0,
                    "stroke-width": 2,
                    "image": "https://buoy.dev.pamdas.org/static/pin-black.svg",
                    "last_voice_call_start_at": None,
                    "location_requested_at": None,
                    "radio_state_at": "1970-01-01T00:00:00+00:00",
                    "radio_state": "na",
                    "coordinateProperties": {"time": "2025-04-24T21:40:29+00:00"},
                    "DateTime": "2025-04-24T21:40:29+00:00",
                },
            },
            "device_status_properties": None,
            "url": "https://buoy.dev.pamdas.org/api/v1.0/subject/9cd78277-f638-4ce6-89f8-55125a1c6540",
        },
        {
            "content_type": "observations.subject",
            "id": "ba4c1908-cf3b-4f7c-af9f-25da7c3d1187",
            "name": "edgetech_88CE99D9CB_B",
            "subject_type": "ropeless_buoy",
            "subject_subtype": "ropeless_buoy_device",
            "common_name": None,
            "additional": {
                "devices": [
                    {
                        "label": "a",
                        "location": {"latitude": 42.203084, "longitude": -70.6084207},
                        "device_id": "edgetech_88CE99D9CB_A",
                        "last_updated": "2025-03-25T13:07:13+00:00",
                    },
                    {
                        "label": "b",
                        "location": {"latitude": 42.2059574, "longitude": -70.6105312},
                        "device_id": "edgetech_88CE99D9CB_B",
                        "last_updated": "2025-03-25T13:07:13+00:00",
                    },
                ],
                "display_id": "b2b5f26d267d",
                "event_type": "gear_retrieved",
                "subject_name": "edgetech_88CE99D9CB_B",
                "edgetech_serial_number": "88CE99D9CB",
            },
            "created_at": "2025-03-28T14:13:43.549276-07:00",
            "updated_at": "2025-03-28T14:13:43.549310-07:00",
            "is_active": True,
            "user": None,
            "tracks_available": True,
            "image_url": "/static/pin-black.svg",
            "last_position_status": {
                "last_voice_call_start_at": None,
                "radio_state_at": None,
                "radio_state": "na",
            },
            "last_position_date": "2025-04-04T13:49:08+00:00",
            "last_position": {
                "type": "Feature",
                "geometry": {"type": "Point", "coordinates": [-70.6100413, 42.206205]},
                "properties": {
                    "title": "edgetech_88CE99D9CB_B",
                    "subject_type": "ropeless_buoy",
                    "subject_subtype": "ropeless_buoy_device",
                    "id": "ba4c1908-cf3b-4f7c-af9f-25da7c3d1187",
                    "stroke": "#FFFF00",
                    "stroke-opacity": 1.0,
                    "stroke-width": 2,
                    "image": "https://buoy.dev.pamdas.org/static/pin-black.svg",
                    "last_voice_call_start_at": None,
                    "location_requested_at": None,
                    "radio_state_at": "1970-01-01T00:00:00+00:00",
                    "radio_state": "na",
                    "coordinateProperties": {"time": "2025-04-04T13:49:08+00:00"},
                    "DateTime": "2025-04-04T13:49:08+00:00",
                },
            },
            "device_status_properties": None,
            "url": "https://buoy.dev.pamdas.org/api/v1.0/subject/ba4c1908-cf3b-4f7c-af9f-25da7c3d1187",
        },
        {
            "content_type": "observations.subject",
            "id": "15aa5d3a-c37f-40fc-88eb-f35a393ebd9c",
            "name": "edgetech_88CE99DA78_A",
            "subject_type": "unassigned",
            "subject_subtype": "ropeless_buoy_device",
            "common_name": None,
            "additional": {
                "devices": [
                    {
                        "label": "a",
                        "location": {
                            "latitude": 49.30788893117735,
                            "longitude": -123.23345710912099,
                        },
                        "device_id": "edgetech_88CE99DA78_A",
                        "last_updated": "2025-03-21T16:05:59+00:00",
                    }
                ],
                "display_id": "e708eaee1be5",
                "event_type": "gear_deployed",
                "subject_name": "edgetech_88CE99DA78_A",
                "subject_is_active": True,
                "edgetech_serial_number": "88CE99DA78",
            },
            "created_at": "2025-03-10T10:00:15.416754-07:00",
            "updated_at": "2025-04-18T16:31:11.970117-07:00",
            "is_active": True,
            "user": None,
            "tracks_available": True,
            "image_url": "/static/pin-black.svg",
            "last_position_status": {
                "last_voice_call_start_at": None,
                "radio_state_at": None,
                "radio_state": "na",
            },
            "last_position_date": "2025-03-20T16:05:59+00:00",
            "last_position": {
                "type": "Feature",
                "geometry": {
                    "type": "Point",
                    "coordinates": [-123.233457109121, 49.30788893117735],
                },
                "properties": {
                    "title": "edgetech_88CE99DA78_A",
                    "subject_type": "unassigned",
                    "subject_subtype": "ropeless_buoy_device",
                    "id": "15aa5d3a-c37f-40fc-88eb-f35a393ebd9c",
                    "stroke": "#FFFF00",
                    "stroke-opacity": 1.0,
                    "stroke-width": 2,
                    "image": "https://buoy.pamdas.org/static/pin-black.svg",
                    "last_voice_call_start_at": None,
                    "location_requested_at": None,
                    "radio_state_at": "1970-01-01T00:00:00+00:00",
                    "radio_state": "na",
                    "coordinateProperties": {"time": "2025-03-21T16:05:59+00:00"},
                    "DateTime": "2025-03-21T16:05:59+00:00",
                },
            },
            "device_status_properties": None,
            "url": "https://buoy.pamdas.org/api/v1.0/subject/15aa5d3a-c37f-40fc-88eb-f35a393ebd9c",
        },
        {
            "content_type": "observations.subject",
            "id": "b7c073c0-210c-4c2a-afba-77774d1d3dd3",
            "name": "edgetech_88CE99DA78_B",
            "subject_type": "unassigned",
            "subject_subtype": "ropeless_buoy_device",
            "common_name": None,
            "additional": {
                "devices": [
                    {
                        "label": "a",
                        "location": {
                            "latitude": 48.41639352795489,
                            "longitude": -123.38347494713835,
                        },
                        "device_id": "edgetech_88CE99DA78_A",
                        "last_updated": "2025-03-10T18:45:04.774000+00:00",
                    },
                    {
                        "label": "b",
                        "location": {
                            "latitude": 48.4048796411028,
                            "longitude": -123.40832268543033,
                        },
                        "device_id": "edgetech_88CE99DA78_B",
                        "last_updated": "2025-03-10T18:45:04.774000+00:00",
                    },
                ],
                "display_id": "88CE99DA78",
                "event_type": "gear_deployed",
                "subject_name": "edgetech_88CE99DA78_B",
                "edgetech_serial_number": "88CE99DA78",
            },
            "created_at": "2025-03-10T11:50:13.145941-07:00",
            "updated_at": "2025-03-10T11:50:13.145962-07:00",
            "is_active": True,
            "user": None,
            "tracks_available": True,
            "image_url": "/static/pin-black.svg",
            "last_position_status": {
                "last_voice_call_start_at": None,
                "radio_state_at": None,
                "radio_state": "na",
            },
            "last_position_date": "2025-03-20T15:40:27+00:00",
            "last_position": {
                "type": "Feature",
                "geometry": {
                    "type": "Point",
                    "coordinates": [-123.2350105886564, 49.30751795885089],
                },
                "properties": {
                    "title": "edgetech_88CE99DA78_B",
                    "subject_type": "unassigned",
                    "subject_subtype": "ropeless_buoy_device",
                    "id": "b7c073c0-210c-4c2a-afba-77774d1d3dd3",
                    "stroke": "#FFFF00",
                    "stroke-opacity": 1.0,
                    "stroke-width": 2,
                    "image": "https://buoy.pamdas.org/static/pin-black.svg",
                    "last_voice_call_start_at": None,
                    "location_requested_at": None,
                    "radio_state_at": "1970-01-01T00:00:00+00:00",
                    "radio_state": "na",
                    "coordinateProperties": {"time": "2025-03-21T15:40:27+00:00"},
                    "DateTime": "2025-03-21T15:40:27+00:00",
                },
            },
            "device_status_properties": None,
            "url": "https://buoy.pamdas.org/api/v1.0/subject/b7c073c0-210c-4c2a-afba-77774d1d3dd3",
        },
    ]


@pytest.fixture
def get_expected_observations_test_edgetech_processor_inserting_buoys():
    return [
        {
            "name": "edgetech_88CE99C99A_A",
            "source": "edgetech_88CE99C99A_A",
            "type": "ropeless_buoy",
            "subject_type": "ropeless_buoy_device",
            "is_active": False,
            "recorded_at": "2024-12-03T16:04:55+00:00",
            "location": {"lat": 41.5740898, "lon": -70.8831463},
            "additional": {
                "subject_name": "edgetech_88CE99C99A_A",
                "edgetech_serial_number": "88CE99C99A",
                "display_id": "e1f4d34d79f2",
                "subject_is_active": False,
                "event_type": "gear_retrieved",
                "devices": [
                    {
                        "label": "a",
                        "location": {"latitude": 41.5740898, "longitude": -70.8831463},
                        "device_id": "edgetech_88CE99C99A_A",
                        "last_updated": "2024-12-03T16:04:55+00:00",
                    }
                ],
            },
        },
        {
            "name": "edgetech_88CE99C99A_A",
            "source": "edgetech_88CE99C99A_A",
            "type": "ropeless_buoy",
            "subject_type": "ropeless_buoy_device",
            "is_active": False,
            "recorded_at": "2024-12-10T14:52:06+00:00",
            "location": {"lat": 41.5740898, "lon": -70.8831463},
            "additional": {
                "subject_name": "edgetech_88CE99C99A_A",
                "edgetech_serial_number": "88CE99C99A",
                "display_id": "e1f4d34d79f2",
                "subject_is_active": False,
                "event_type": "gear_retrieved",
                "devices": [
                    {
                        "label": "a",
                        "location": {"latitude": 41.5740898, "longitude": -70.8831463},
                        "device_id": "edgetech_88CE99C99A_A",
                        "last_updated": "2024-12-10T14:52:06+00:00",
                    }
                ],
            },
        },
        {
            "name": "edgetech_88CE99C99A_A",
            "source": "edgetech_88CE99C99A_A",
            "type": "ropeless_buoy",
            "subject_type": "ropeless_buoy_device",
            "is_active": False,
            "recorded_at": "2025-03-14T12:07:27+00:00",
            "location": {"lat": 41.7832483, "lon": -70.7527803},
            "additional": {
                "subject_name": "edgetech_88CE99C99A_A",
                "edgetech_serial_number": "88CE99C99A",
                "display_id": "e1f4d34d79f2",
                "subject_is_active": False,
                "event_type": "gear_retrieved",
                "devices": [
                    {
                        "label": "a",
                        "location": {"latitude": 41.7832483, "longitude": -70.7527803},
                        "device_id": "edgetech_88CE99C99A_A",
                        "last_updated": "2025-03-14T12:07:27+00:00",
                    }
                ],
            },
        },
        {
            "name": "edgetech_88CE999763_A",
            "source": "edgetech_88CE999763_A",
            "type": "ropeless_buoy",
            "subject_type": "ropeless_buoy_device",
            "is_active": True,
            "recorded_at": "2025-03-17T16:26:12+00:00",
            "location": {"lat": 41.52546746182916, "lon": -70.67401171221228},
            "additional": {
                "subject_name": "edgetech_88CE999763_A",
                "edgetech_serial_number": "88CE999763",
                "display_id": "dc5103663894",
                "subject_is_active": True,
                "event_type": "gear_deployed",
                "devices": [
                    {
                        "label": "a",
                        "location": {
                            "latitude": 41.52546746182916,
                            "longitude": -70.67401171221228,
                        },
                        "device_id": "edgetech_88CE999763_A",
                        "last_updated": "2025-03-17T16:26:12+00:00",
                    }
                ],
            },
        },
        {
            "name": "edgetech_88CE999763_A",
            "source": "edgetech_88CE999763_A",
            "type": "ropeless_buoy",
            "subject_type": "ropeless_buoy_device",
            "is_active": False,
            "recorded_at": "2025-03-17T16:41:22+00:00",
            "location": {"lat": 41.52546746182916, "lon": -70.67401171221228},
            "additional": {
                "subject_name": "edgetech_88CE999763_A",
                "edgetech_serial_number": "88CE999763",
                "display_id": "dc5103663894",
                "subject_is_active": False,
                "event_type": "gear_retrieved",
                "devices": [
                    {
                        "label": "a",
                        "location": {
                            "latitude": 41.52546746182916,
                            "longitude": -70.67401171221228,
                        },
                        "device_id": "edgetech_88CE999763_A",
                        "last_updated": "2025-03-17T16:41:22+00:00",
                    }
                ],
            },
        },
        {
            "name": "edgetech_88CE999763_A",
            "source": "edgetech_88CE999763_A",
            "type": "ropeless_buoy",
            "subject_type": "ropeless_buoy_device",
            "is_active": True,
            "recorded_at": "2025-03-17T16:43:40+00:00",
            "location": {"lat": 41.52546746182916, "lon": -70.67401171221228},
            "additional": {
                "subject_name": "edgetech_88CE999763_A",
                "edgetech_serial_number": "88CE999763",
                "display_id": "5eb353fb0f49",
                "subject_is_active": True,
                "event_type": "gear_deployed",
                "devices": [
                    {
                        "label": "a",
                        "location": {
                            "latitude": 41.52546746182916,
                            "longitude": -70.67401171221228,
                        },
                        "device_id": "edgetech_88CE999763_A",
                        "last_updated": "2025-03-17T16:43:40+00:00",
                    },
                    {
                        "label": "b",
                        "location": {
                            "latitude": 41.52537796592242,
                            "longitude": -70.6738777899687,
                        },
                        "device_id": "edgetech_88CE999763_B",
                        "last_updated": "2025-03-17T16:43:40+00:00",
                    },
                ],
            },
        },
        {
            "name": "edgetech_88CE999763_B",
            "source": "edgetech_88CE999763_B",
            "type": "ropeless_buoy",
            "subject_type": "ropeless_buoy_device",
            "is_active": True,
            "recorded_at": "2025-03-17T16:43:40+00:00",
            "location": {"lat": 41.52537796592242, "lon": -70.6738777899687},
            "additional": {
                "subject_name": "edgetech_88CE999763_B",
                "edgetech_serial_number": "88CE999763",
                "display_id": "5eb353fb0f49",
                "subject_is_active": True,
                "event_type": "gear_deployed",
                "devices": [
                    {
                        "label": "a",
                        "location": {
                            "latitude": 41.52546746182916,
                            "longitude": -70.67401171221228,
                        },
                        "device_id": "edgetech_88CE999763_A",
                        "last_updated": "2025-03-17T16:43:40+00:00",
                    },
                    {
                        "label": "b",
                        "location": {
                            "latitude": 41.52537796592242,
                            "longitude": -70.6738777899687,
                        },
                        "device_id": "edgetech_88CE999763_B",
                        "last_updated": "2025-03-17T16:43:40+00:00",
                    },
                ],
            },
        },
        {
            "name": "edgetech_88CE999763_A",
            "source": "edgetech_88CE999763_A",
            "type": "ropeless_buoy",
            "subject_type": "ropeless_buoy_device",
            "is_active": False,
            "recorded_at": "2025-03-17T17:36:32+00:00",
            "location": {"lat": 41.52546746182916, "lon": -70.67401171221228},
            "additional": {
                "subject_name": "edgetech_88CE999763_A",
                "edgetech_serial_number": "88CE999763",
                "display_id": "5eb353fb0f49",
                "subject_is_active": False,
                "event_type": "gear_retrieved",
                "devices": [
                    {
                        "label": "a",
                        "location": {
                            "latitude": 41.52546746182916,
                            "longitude": -70.67401171221228,
                        },
                        "device_id": "edgetech_88CE999763_A",
                        "last_updated": "2025-03-17T17:36:32+00:00",
                    },
                    {
                        "label": "b",
                        "location": {
                            "latitude": 41.52537796592242,
                            "longitude": -70.6738777899687,
                        },
                        "device_id": "edgetech_88CE999763_B",
                        "last_updated": "2025-03-17T17:36:32+00:00",
                    },
                ],
            },
        },
        {
            "name": "edgetech_88CE999763_B",
            "source": "edgetech_88CE999763_B",
            "type": "ropeless_buoy",
            "subject_type": "ropeless_buoy_device",
            "is_active": False,
            "recorded_at": "2025-03-17T17:36:32+00:00",
            "location": {"lat": 41.52537796592242, "lon": -70.6738777899687},
            "additional": {
                "subject_name": "edgetech_88CE999763_B",
                "edgetech_serial_number": "88CE999763",
                "display_id": "5eb353fb0f49",
                "subject_is_active": False,
                "event_type": "gear_retrieved",
                "devices": [
                    {
                        "label": "a",
                        "location": {
                            "latitude": 41.52546746182916,
                            "longitude": -70.67401171221228,
                        },
                        "device_id": "edgetech_88CE999763_A",
                        "last_updated": "2025-03-17T17:36:32+00:00",
                    },
                    {
                        "label": "b",
                        "location": {
                            "latitude": 41.52537796592242,
                            "longitude": -70.6738777899687,
                        },
                        "device_id": "edgetech_88CE999763_B",
                        "last_updated": "2025-03-17T17:36:32+00:00",
                    },
                ],
            },
        },
        {
            "name": "edgetech_88CE99DA78_A",
            "source": "edgetech_88CE99DA78_A",
            "type": "ropeless_buoy",
            "subject_type": "ropeless_buoy_device",
            "is_active": True,
            "recorded_at": "2025-03-21T16:05:59+00:00",
            "location": {"lat": 49.30788893117735, "lon": -123.23345710912099},
            "additional": {
                "subject_name": "edgetech_88CE99DA78_A",
                "edgetech_serial_number": "88CE99DA78",
                "display_id": "e708eaee1be5",
                "subject_is_active": True,
                "event_type": "gear_deployed",
                "devices": [
                    {
                        "label": "a",
                        "location": {
                            "latitude": 49.30788893117735,
                            "longitude": -123.23345710912099,
                        },
                        "device_id": "edgetech_88CE99DA78_A",
                        "last_updated": "2025-03-21T16:05:59+00:00",
                    }
                ],
            },
        },
        {
            "name": "edgetech_88CE99D9CB_A",
            "source": "edgetech_88CE99D9CB_A",
            "type": "ropeless_buoy",
            "subject_type": "ropeless_buoy_device",
            "is_active": False,
            "recorded_at": "2025-04-10T16:24:20+00:00",
            "location": {"lat": 42.2290093, "lon": -70.6304546},
            "additional": {
                "subject_name": "edgetech_88CE99D9CB_A",
                "edgetech_serial_number": "88CE99D9CB",
                "display_id": "2e1a1f4d63c5",
                "subject_is_active": False,
                "event_type": "gear_retrieved",
                "devices": [
                    {
                        "label": "a",
                        "location": {"latitude": 42.2290093, "longitude": -70.6304546},
                        "device_id": "edgetech_88CE99D9CB_A",
                        "last_updated": "2025-04-10T16:24:20+00:00",
                    }
                ],
            },
        },
        {
            "name": "edgetech_88CE99D9CB_A",
            "source": "edgetech_88CE99D9CB_A",
            "type": "ropeless_buoy",
            "subject_type": "ropeless_buoy_device",
            "is_active": False,
            "recorded_at": "2025-04-24T21:40:29+00:00",
            "location": {"lat": 42.2290093, "lon": -70.6304546},
            "additional": {
                "subject_name": "edgetech_88CE99D9CB_A",
                "edgetech_serial_number": "88CE99D9CB",
                "display_id": "2e1a1f4d63c5",
                "subject_is_active": False,
                "event_type": "gear_retrieved",
                "devices": [
                    {
                        "label": "a",
                        "location": {"latitude": 42.2290093, "longitude": -70.6304546},
                        "device_id": "edgetech_88CE99D9CB_A",
                        "last_updated": "2025-04-24T21:40:29+00:00",
                    }
                ],
            },
        },
    ]


@pytest.fixture
def get_expected_observations_test_create_observations_with_last_updated_timestamp():
    return [
        {
            "name": "edgetech_88CE999763_A",
            "source": "edgetech_88CE999763_A",
            "type": "ropeless_buoy",
            "subject_type": "ropeless_buoy_device",
            "is_active": False,
            "recorded_at": "2025-03-17T17:34:32+00:00",
            "location": {"lat": 41.52546746182916, "lon": -70.67401171221228},
            "additional": {
                "subject_name": "edgetech_88CE999763_A",
                "edgetech_serial_number": "88CE999763",
                "display_id": "5eb353fb0f49",
                "subject_is_active": False,
                "event_type": "gear_retrieved",
                "devices": [
                    {
                        "label": "a",
                        "location": {
                            "latitude": 41.52546746182916,
                            "longitude": -70.67401171221228,
                        },
                        "device_id": "edgetech_88CE999763_A",
                        "last_updated": "2025-03-17T17:34:32+00:00",
                    },
                    {
                        "label": "b",
                        "location": {
                            "latitude": 41.52537796592242,
                            "longitude": -70.6738777899687,
                        },
                        "device_id": "edgetech_88CE999763_B",
                        "last_updated": "2025-03-17T17:34:32+00:00",
                    },
                ],
            },
        },
        {
            "name": "edgetech_88CE999763_B",
            "source": "edgetech_88CE999763_B",
            "type": "ropeless_buoy",
            "subject_type": "ropeless_buoy_device",
            "is_active": False,
            "recorded_at": "2025-03-17T17:34:32+00:00",
            "location": {"lat": 41.52537796592242, "lon": -70.6738777899687},
            "additional": {
                "subject_name": "edgetech_88CE999763_B",
                "edgetech_serial_number": "88CE999763",
                "display_id": "5eb353fb0f49",
                "subject_is_active": False,
                "event_type": "gear_retrieved",
                "devices": [
                    {
                        "label": "a",
                        "location": {
                            "latitude": 41.52546746182916,
                            "longitude": -70.67401171221228,
                        },
                        "device_id": "edgetech_88CE999763_A",
                        "last_updated": "2025-03-17T17:34:32+00:00",
                    },
                    {
                        "label": "b",
                        "location": {
                            "latitude": 41.52537796592242,
                            "longitude": -70.6738777899687,
                        },
                        "device_id": "edgetech_88CE999763_B",
                        "last_updated": "2025-03-17T17:34:32+00:00",
                    },
                ],
            },
        },
        {
            "name": "edgetech_88CE99D9CB_A",
            "source": "edgetech_88CE99D9CB_A",
            "type": "ropeless_buoy",
            "subject_type": "ropeless_buoy_device",
            "is_active": False,
            "recorded_at": "2025-04-10T16:24:20+00:00",
            "location": {"lat": 42.2290093, "lon": -70.6304546},
            "additional": {
                "subject_name": "edgetech_88CE99D9CB_A",
                "edgetech_serial_number": "88CE99D9CB",
                "display_id": "2e1a1f4d63c5",
                "subject_is_active": False,
                "event_type": "gear_retrieved",
                "devices": [
                    {
                        "label": "a",
                        "location": {"latitude": 42.2290093, "longitude": -70.6304546},
                        "device_id": "edgetech_88CE99D9CB_A",
                        "last_updated": "2025-04-10T16:24:20+00:00",
                    }
                ],
            },
        },
        {
            "name": "edgetech_88CE99DA78_A",
            "source": "edgetech_88CE99DA78_A",
            "type": "ropeless_buoy",
            "subject_type": "ropeless_buoy_device",
            "is_active": True,
            "recorded_at": "2025-03-21T16:05:59+00:00",
            "location": {"lat": 49.30788893117735, "lon": -123.23345710912099},
            "additional": {
                "subject_name": "edgetech_88CE99DA78_A",
                "edgetech_serial_number": "88CE99DA78",
                "display_id": "e708eaee1be5",
                "subject_is_active": True,
                "event_type": "gear_deployed",
                "devices": [
                    {
                        "label": "a",
                        "location": {
                            "latitude": 49.30788893117735,
                            "longitude": -123.23345710912099,
                        },
                        "device_id": "edgetech_88CE99DA78_A",
                        "last_updated": "2025-03-21T16:05:59+00:00",
                    }
                ],
            },
        },
    ]


@pytest.fixture
def get_expected_observations_test_create_observations():
    return [
        {
            "name": "edgetech_88CE9978AE_A",
            "source": "edgetech_88CE9978AE_A",
            "type": "ropeless_buoy",
            "subject_type": "ropeless_buoy_device",
            "is_active": True,
            "recorded_at": "2024-10-22T16:34:46+00:00",
            "location": {"lat": 41.82907459248435, "lon": -71.41540430869928},
            "additional": {
                "subject_name": "edgetech_88CE9978AE_A",
                "edgetech_serial_number": "88CE9978AE",
                "display_id": "f1ab617fc777",
                "subject_is_active": True,
                "event_type": "gear_deployed",
                "devices": [
                    {
                        "label": "a",
                        "location": {
                            "latitude": 41.82907459248435,
                            "longitude": -71.41540430869928,
                        },
                        "device_id": "edgetech_88CE9978AE_A",
                        "last_updated": "2024-10-22T16:34:46+00:00",
                    }
                ],
            },
        },
        {
            "name": "edgetech_88CE99C99A_A",
            "source": "edgetech_88CE99C99A_A",
            "type": "ropeless_buoy",
            "subject_type": "ropeless_buoy_device",
            "is_active": False,
            "recorded_at": "2024-12-03T16:04:55+00:00",
            "location": {"lat": 41.5740898, "lon": -70.8831463},
            "additional": {
                "subject_name": "edgetech_88CE99C99A_A",
                "edgetech_serial_number": "88CE99C99A",
                "display_id": "e1f4d34d79f2",
                "subject_is_active": False,
                "event_type": "gear_retrieved",
                "devices": [
                    {
                        "label": "a",
                        "location": {"latitude": 41.5740898, "longitude": -70.8831463},
                        "device_id": "edgetech_88CE99C99A_A",
                        "last_updated": "2024-12-03T16:04:55+00:00",
                    }
                ],
            },
        },
        {
            "name": "edgetech_88CE99C99A_A",
            "source": "edgetech_88CE99C99A_A",
            "type": "ropeless_buoy",
            "subject_type": "ropeless_buoy_device",
            "is_active": False,
            "recorded_at": "2025-03-14T12:07:27+00:00",
            "location": {"lat": 41.7832483, "lon": -70.7527803},
            "additional": {
                "subject_name": "edgetech_88CE99C99A_A",
                "edgetech_serial_number": "88CE99C99A",
                "display_id": "e1f4d34d79f2",
                "subject_is_active": False,
                "event_type": "gear_retrieved",
                "devices": [
                    {
                        "label": "a",
                        "location": {"latitude": 41.7832483, "longitude": -70.7527803},
                        "device_id": "edgetech_88CE99C99A_A",
                        "last_updated": "2025-03-14T12:07:27+00:00",
                    }
                ],
            },
        },
        {
            "name": "edgetech_88CE999763_A",
            "source": "edgetech_88CE999763_A",
            "type": "ropeless_buoy",
            "subject_type": "ropeless_buoy_device",
            "is_active": True,
            "recorded_at": "2025-03-17T16:26:12+00:00",
            "location": {"lat": 41.52546746182916, "lon": -70.67401171221228},
            "additional": {
                "subject_name": "edgetech_88CE999763_A",
                "edgetech_serial_number": "88CE999763",
                "display_id": "dc5103663894",
                "subject_is_active": True,
                "event_type": "gear_deployed",
                "devices": [
                    {
                        "label": "a",
                        "location": {
                            "latitude": 41.52546746182916,
                            "longitude": -70.67401171221228,
                        },
                        "device_id": "edgetech_88CE999763_A",
                        "last_updated": "2025-03-17T16:26:12+00:00",
                    }
                ],
            },
        },
        {
            "name": "edgetech_88CE999763_A",
            "source": "edgetech_88CE999763_A",
            "type": "ropeless_buoy",
            "subject_type": "ropeless_buoy_device",
            "is_active": False,
            "recorded_at": "2025-03-17T16:41:22+00:00",
            "location": {"lat": 41.52546746182916, "lon": -70.67401171221228},
            "additional": {
                "subject_name": "edgetech_88CE999763_A",
                "edgetech_serial_number": "88CE999763",
                "display_id": "dc5103663894",
                "subject_is_active": False,
                "event_type": "gear_retrieved",
                "devices": [
                    {
                        "label": "a",
                        "location": {
                            "latitude": 41.52546746182916,
                            "longitude": -70.67401171221228,
                        },
                        "device_id": "edgetech_88CE999763_A",
                        "last_updated": "2025-03-17T16:41:22+00:00",
                    }
                ],
            },
        },
        {
            "name": "edgetech_88CE999763_A",
            "source": "edgetech_88CE999763_A",
            "type": "ropeless_buoy",
            "subject_type": "ropeless_buoy_device",
            "is_active": True,
            "recorded_at": "2025-03-17T16:43:40+00:00",
            "location": {"lat": 41.52546746182916, "lon": -70.67401171221228},
            "additional": {
                "subject_name": "edgetech_88CE999763_A",
                "edgetech_serial_number": "88CE999763",
                "display_id": "5eb353fb0f49",
                "subject_is_active": True,
                "event_type": "gear_deployed",
                "devices": [
                    {
                        "label": "a",
                        "location": {
                            "latitude": 41.52546746182916,
                            "longitude": -70.67401171221228,
                        },
                        "device_id": "edgetech_88CE999763_A",
                        "last_updated": "2025-03-17T16:43:40+00:00",
                    },
                    {
                        "label": "b",
                        "location": {
                            "latitude": 41.52537796592242,
                            "longitude": -70.6738777899687,
                        },
                        "device_id": "edgetech_88CE999763_B",
                        "last_updated": "2025-03-17T16:43:40+00:00",
                    },
                ],
            },
        },
        {
            "name": "edgetech_88CE999763_B",
            "source": "edgetech_88CE999763_B",
            "type": "ropeless_buoy",
            "subject_type": "ropeless_buoy_device",
            "is_active": True,
            "recorded_at": "2025-03-17T16:43:40+00:00",
            "location": {"lat": 41.52537796592242, "lon": -70.6738777899687},
            "additional": {
                "subject_name": "edgetech_88CE999763_B",
                "edgetech_serial_number": "88CE999763",
                "display_id": "5eb353fb0f49",
                "subject_is_active": True,
                "event_type": "gear_deployed",
                "devices": [
                    {
                        "label": "a",
                        "location": {
                            "latitude": 41.52546746182916,
                            "longitude": -70.67401171221228,
                        },
                        "device_id": "edgetech_88CE999763_A",
                        "last_updated": "2025-03-17T16:43:40+00:00",
                    },
                    {
                        "label": "b",
                        "location": {
                            "latitude": 41.52537796592242,
                            "longitude": -70.6738777899687,
                        },
                        "device_id": "edgetech_88CE999763_B",
                        "last_updated": "2025-03-17T16:43:40+00:00",
                    },
                ],
            },
        },
        {
            "name": "edgetech_88CE999763_A",
            "source": "edgetech_88CE999763_A",
            "type": "ropeless_buoy",
            "subject_type": "ropeless_buoy_device",
            "is_active": False,
            "recorded_at": "2025-03-17T17:36:32+00:00",
            "location": {"lat": 41.52546746182916, "lon": -70.67401171221228},
            "additional": {
                "subject_name": "edgetech_88CE999763_A",
                "edgetech_serial_number": "88CE999763",
                "display_id": "5eb353fb0f49",
                "subject_is_active": False,
                "event_type": "gear_retrieved",
                "devices": [
                    {
                        "label": "a",
                        "location": {
                            "latitude": 41.52546746182916,
                            "longitude": -70.67401171221228,
                        },
                        "device_id": "edgetech_88CE999763_A",
                        "last_updated": "2025-03-17T17:36:32+00:00",
                    },
                    {
                        "label": "b",
                        "location": {
                            "latitude": 41.52537796592242,
                            "longitude": -70.6738777899687,
                        },
                        "device_id": "edgetech_88CE999763_B",
                        "last_updated": "2025-03-17T17:36:32+00:00",
                    },
                ],
            },
        },
        {
            "name": "edgetech_88CE999763_B",
            "source": "edgetech_88CE999763_B",
            "type": "ropeless_buoy",
            "subject_type": "ropeless_buoy_device",
            "is_active": False,
            "recorded_at": "2025-03-17T17:36:32+00:00",
            "location": {"lat": 41.52537796592242, "lon": -70.6738777899687},
            "additional": {
                "subject_name": "edgetech_88CE999763_B",
                "edgetech_serial_number": "88CE999763",
                "display_id": "5eb353fb0f49",
                "subject_is_active": False,
                "event_type": "gear_retrieved",
                "devices": [
                    {
                        "label": "a",
                        "location": {
                            "latitude": 41.52546746182916,
                            "longitude": -70.67401171221228,
                        },
                        "device_id": "edgetech_88CE999763_A",
                        "last_updated": "2025-03-17T17:36:32+00:00",
                    },
                    {
                        "label": "b",
                        "location": {
                            "latitude": 41.52537796592242,
                            "longitude": -70.6738777899687,
                        },
                        "device_id": "edgetech_88CE999763_B",
                        "last_updated": "2025-03-17T17:36:32+00:00",
                    },
                ],
            },
        },
        {
            "name": "edgetech_88CE99DA78_A",
            "source": "edgetech_88CE99DA78_A",
            "type": "ropeless_buoy",
            "subject_type": "ropeless_buoy_device",
            "is_active": True,
            "recorded_at": "2025-03-21T16:05:59+00:00",
            "location": {"lat": 49.30788893117735, "lon": -123.23345710912099},
            "additional": {
                "subject_name": "edgetech_88CE99DA78_A",
                "edgetech_serial_number": "88CE99DA78",
                "display_id": "e708eaee1be5",
                "subject_is_active": True,
                "event_type": "gear_deployed",
                "devices": [
                    {
                        "label": "a",
                        "location": {
                            "latitude": 49.30788893117735,
                            "longitude": -123.23345710912099,
                        },
                        "device_id": "edgetech_88CE99DA78_A",
                        "last_updated": "2025-03-21T16:05:59+00:00",
                    }
                ],
            },
        },
        {
            "name": "edgetech_88CE99D9CB_A",
            "source": "edgetech_88CE99D9CB_A",
            "type": "ropeless_buoy",
            "subject_type": "ropeless_buoy_device",
            "is_active": False,
            "recorded_at": "2025-04-10T16:24:20+00:00",
            "location": {"lat": 42.2290093, "lon": -70.6304546},
            "additional": {
                "subject_name": "edgetech_88CE99D9CB_A",
                "edgetech_serial_number": "88CE99D9CB",
                "display_id": "2e1a1f4d63c5",
                "subject_is_active": False,
                "event_type": "gear_retrieved",
                "devices": [
                    {
                        "label": "a",
                        "location": {"latitude": 42.2290093, "longitude": -70.6304546},
                        "device_id": "edgetech_88CE99D9CB_A",
                        "last_updated": "2025-04-10T16:24:20+00:00",
                    }
                ],
            },
        },
    ]


@pytest.fixture
def get_expected_observations_test_create_observations_recored_at_same_as_current_state():
    return [
        {
            "name": "edgetech_88CE999763_A",
            "source": "edgetech_88CE999763_A",
            "type": "ropeless_buoy",
            "subject_type": "ropeless_buoy_device",
            "is_active": False,
            "recorded_at": "2025-03-17T17:36:32+00:00",
            "location": {"lat": 41.52546746182916, "lon": -70.67401171221228},
            "additional": {
                "subject_name": "edgetech_88CE999763_A",
                "edgetech_serial_number": "88CE999763",
                "display_id": "5eb353fb0f49",
                "subject_is_active": False,
                "event_type": "gear_retrieved",
                "devices": [
                    {
                        "label": "a",
                        "location": {
                            "latitude": 41.52546746182916,
                            "longitude": -70.67401171221228,
                        },
                        "device_id": "edgetech_88CE999763_A",
                        "last_updated": "2025-03-17T17:36:32+00:00",
                    },
                    {
                        "label": "b",
                        "location": {
                            "latitude": 41.52537796592242,
                            "longitude": -70.6738777899687,
                        },
                        "device_id": "edgetech_88CE999763_B",
                        "last_updated": "2025-03-17T17:36:32+00:00",
                    },
                ],
            },
        },
        {
            "name": "edgetech_88CE999763_B",
            "source": "edgetech_88CE999763_B",
            "type": "ropeless_buoy",
            "subject_type": "ropeless_buoy_device",
            "is_active": False,
            "recorded_at": "2025-03-17T17:36:32+00:00",
            "location": {"lat": 41.52537796592242, "lon": -70.6738777899687},
            "additional": {
                "subject_name": "edgetech_88CE999763_B",
                "edgetech_serial_number": "88CE999763",
                "display_id": "5eb353fb0f49",
                "subject_is_active": False,
                "event_type": "gear_retrieved",
                "devices": [
                    {
                        "label": "a",
                        "location": {
                            "latitude": 41.52546746182916,
                            "longitude": -70.67401171221228,
                        },
                        "device_id": "edgetech_88CE999763_A",
                        "last_updated": "2025-03-17T17:36:32+00:00",
                    },
                    {
                        "label": "b",
                        "location": {
                            "latitude": 41.52537796592242,
                            "longitude": -70.6738777899687,
                        },
                        "device_id": "edgetech_88CE999763_B",
                        "last_updated": "2025-03-17T17:36:32+00:00",
                    },
                ],
            },
        },
        {
            "name": "edgetech_88CE99D9CB_A",
            "source": "edgetech_88CE99D9CB_A",
            "type": "ropeless_buoy",
            "subject_type": "ropeless_buoy_device",
            "is_active": False,
            "recorded_at": "2025-04-10T16:24:20+00:00",
            "location": {"lat": 42.2290093, "lon": -70.6304546},
            "additional": {
                "subject_name": "edgetech_88CE99D9CB_A",
                "edgetech_serial_number": "88CE99D9CB",
                "display_id": "2e1a1f4d63c5",
                "subject_is_active": False,
                "event_type": "gear_retrieved",
                "devices": [
                    {
                        "label": "a",
                        "location": {"latitude": 42.2290093, "longitude": -70.6304546},
                        "device_id": "edgetech_88CE99D9CB_A",
                        "last_updated": "2025-04-10T16:24:20+00:00",
                    }
                ],
            },
        },
        {
            "name": "edgetech_88CE99DA78_A",
            "source": "edgetech_88CE99DA78_A",
            "type": "ropeless_buoy",
            "subject_type": "ropeless_buoy_device",
            "is_active": True,
            "recorded_at": "2025-03-21T16:05:59+00:00",
            "location": {"lat": 49.30788893117735, "lon": -123.23345710912099},
            "additional": {
                "subject_name": "edgetech_88CE99DA78_A",
                "edgetech_serial_number": "88CE99DA78",
                "display_id": "e708eaee1be5",
                "subject_is_active": True,
                "event_type": "gear_deployed",
                "devices": [
                    {
                        "label": "a",
                        "location": {
                            "latitude": 49.30788893117735,
                            "longitude": -123.23345710912099,
                        },
                        "device_id": "edgetech_88CE99DA78_A",
                        "last_updated": "2025-03-21T16:05:59+00:00",
                    }
                ],
            },
        },
    ]


@pytest.fixture
def get_observations_update_buoys():
    return [
        {
            "name": "edgetech_88CE99DA78_A",
            "source": "edgetech_88CE99DA78_A",
            "type": "ropeless_buoy",
            "subject_type": "ropeless_buoy_device",
            "is_active": True,
            "recorded_at": "2025-03-21T16:05:59+00:00",
            "location": {"lat": 49.30788893117735, "lon": -123.23345710912099},
            "additional": {
                "subject_name": "edgetech_88CE99DA78_A",
                "edgetech_serial_number": "88CE99DA78",
                "display_id": "e708eaee1be5",
                "subject_is_active": True,
                "event_type": "gear_deployed",
                "devices": [
                    {
                        "label": "a",
                        "location": {
                            "latitude": 49.30788893117735,
                            "longitude": -123.23345710912099,
                        },
                        "device_id": "edgetech_88CE99DA78_A",
                        "last_updated": "2025-03-21T16:05:59+00:00",
                    },
                    {
                        "label": "b",
                        "location": {
                            "latitude": 49.30788893117735,
                            "longitude": -123.23345710912099,
                        },
                        "device_id": "edgetech_88CE99DA78_B",
                        "last_updated": "2025-03-21T16:05:59+00:00",
                    },
                ],
            },
        },
        {
            "name": "edgetech_88CE99DA78_A",
            "source": "edgetech_88CE99DA78_A",
            "type": "ropeless_buoy",
            "subject_type": "ropeless_buoy_device",
            "is_active": False,
            "recorded_at": "2025-03-21T16:04:59+00:00",
            "location": {"lat": 49.30788893117735, "lon": -123.23345710912099},
            "additional": {
                "subject_name": "edgetech_88CE99DA78_A",
                "edgetech_serial_number": "88CE99DA78",
                "display_id": "e2d54db783f6",
                "subject_is_active": False,
                "event_type": "gear_retrieved",
                "devices": [
                    {
                        "label": "a",
                        "location": {
                            "latitude": 49.30788893117735,
                            "longitude": -123.23345710912099,
                        },
                        "device_id": "edgetech_88CE99DA78_A",
                        "last_updated": "2025-03-21T16:05:59+00:00",
                    },
                    {
                        "label": "b",
                        "location": {
                            "latitude": 49.30788893117735,
                            "longitude": -123.23345710912099,
                        },
                        "device_id": "edgetech_88CE99DA78_B",
                        "last_updated": "2025-03-21T16:05:59+00:00",
                    },
                ],
            },
        },
        {
            "name": "edgetech_88CE99DA78_B",
            "source": "edgetech_88CE99DA78_B",
            "type": "ropeless_buoy",
            "subject_type": "ropeless_buoy_device",
            "is_active": False,
            "recorded_at": "2025-03-21T16:04:59+00:00",
            "location": {"lat": 49.30788893117735, "lon": -123.23345710912099},
            "additional": {
                "subject_name": "edgetech_88CE99DA78_B",
                "edgetech_serial_number": "88CE99DA78",
                "display_id": "e2d54db783f6",
                "subject_is_active": False,
                "event_type": "gear_retrieved",
                "devices": [
                    {
                        "label": "a",
                        "location": {
                            "latitude": 49.30788893117735,
                            "longitude": -123.23345710912099,
                        },
                        "device_id": "edgetech_88CE99DA78_A",
                        "last_updated": "2025-03-21T16:05:59+00:00",
                    },
                    {
                        "label": "b",
                        "location": {
                            "latitude": 49.30788893117735,
                            "longitude": -123.23345710912099,
                        },
                        "device_id": "edgetech_88CE99DA78_B",
                        "last_updated": "2025-03-21T16:05:59+00:00",
                    },
                ],
            },
        },
    ]
